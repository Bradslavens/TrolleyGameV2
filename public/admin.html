<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trolley Game - Admin</title>
    <link rel="stylesheet" href="admin.css">
</head>
<body>
    <h1>Admin Page</h1>

    <div class="form-container">
        <h2>Add Line</h2>
        <input type="text" id="lineName" placeholder="Line Name (e.g., Blue Line)">
        <button id="addLineButton">Add Line</button>
    </div>

    <div class="form-container">
        <h2>Add Signal Name</h2>
        <select id="lineSelect"></select>
        <input type="text" id="signalName" placeholder="Signal Name (e.g., A, B, C)">
        <button id="addSignalButton">Add Signal</button>
    </div>

    <script type="module">
        // Firebase configuration
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-app.js";
        import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-database.js";

        const firebaseConfig = {
            
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Add Line
        document.getElementById('addLineButton').addEventListener('click', () => {
            const lineName = document.getElementById('lineName').value;
            console.log(`Adding line: ${lineName}`);
            if (lineName) {
                set(ref(database, 'lines/' + lineName), {
                    name: lineName,
                    signals: []
                }).then(() => {
                    console.log(`Line ${lineName} added successfully.`);
                    alert(`Line ${lineName} added successfully.`);
                    document.getElementById('lineName').value = '';
                    loadLines();
                }).catch(error => {
                    console.error("Error writing to database: ", error);
                });
            } else {
                console.log("Line name is empty.");
            }
        });

        // Load lines into the select dropdown
        function loadLines() {
            console.log("Loading lines...");
            const lineSelect = document.getElementById('lineSelect');
            lineSelect.innerHTML = ''; // Clear current options
            get(child(ref(database), 'lines')).then((snapshot) => {
                snapshot.forEach((childSnapshot) => {
                    const line = childSnapshot.val();
                    const option = document.createElement('option');
                    option.value = line.name;
                    option.textContent = line.name;
                    lineSelect.appendChild(option);
                });
                console.log("Lines loaded.");
            }).catch(error => {
                console.error("Error reading from database: ", error);
            });
        }

        // Add Signal
        document.getElementById('addSignalButton').addEventListener('click', () => {
            const lineName = document.getElementById('lineSelect').value;
            const signalName = document.getElementById('signalName').value;
            console.log(`Adding signal: ${signalName} to line: ${lineName}`);
            if (lineName && signalName) {
                const lineRef = ref(database, 'lines/' + lineName + '/signals');
                get(lineRef).then((snapshot) => {
                    const signals = snapshot.val() || [];
                    signals.push(signalName);
                    set(lineRef, signals).then(() => {
                        console.log(`Signal ${signalName} added to ${lineName} successfully.`);
                        alert(`Signal ${signalName} added to ${lineName} successfully.`);
                        document.getElementById('signalName').value = '';
                    }).catch(error => {
                        console.error("Error writing to database: ", error);
                    });
                }).catch(error => {
                    console.error("Error reading from database: ", error);
                });
            } else {
                console.log("Line name or signal name is empty.");
            }
        });

        // Load lines on page load
        window.onload = loadLines;
    </script>
</body>
</html>
